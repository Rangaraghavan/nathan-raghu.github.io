<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta charset="utf-8" />
</head>
<body onload="getAuthCode()">
	<div id="DivAuthCode"></div>


	<script>
		function getAuthCode() {			
			
			var url = window.location.href;			
			var substring = 'code=';
			var index = url.indexOf(substring);

			if (index !== -1) {
				debugger;
				var authcode =  url.substring((index + substring.length) , url.length )
				var srcHostUrl = url.split('&')[0].split('?h=')[1];
				var newUrl = (srcHostUrl + '?code=' + authcode);
				try{
					var div = document.getElementById("DivAuthCode");
					div.textContent = authcode;
					//alert('posting message to parent window');					
					/*if (window.parent){
						if (window.parent.opener)
							window.parent.opener.postMessage(authcode , '*');
						else 
							window.parent.postMessage(authcode,'*');
					}*/
					alert('New Host Url : ' + decodeURI(newUrl));
					location.href = decodeURI(newUrl);
				}
				catch(e){
					alert('error occurred while posting - trying with localStorage. error: '  + e);
				        //unable to post the message back to the opener window
					//store the message in a localStorage
					//localStorage.setItem("auth_code",authcode);
				}

				
			}
		}
	</script>

</body>
</html>
